version: '3.8'

services:
  # =========================================
  # 1. Your Main Website Application
  # =========================================
  web:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "80:80"
    restart: always
    container_name: exceed_website_app

  # =========================================
  # 2. Monitoring Stack
  # =========================================

  # Blackbox Exporter: Checks if the website is returning 200 OK
  blackbox_exporter:
    image: prom/blackbox-exporter:master
    container_name: blackbox_exporter
    ports:
      - "9115:9115"
    volumes:
      - ./monitoring/blackbox:/config
    command: --config.file=/config/config.yml
    restart: always

  # Prometheus: Collects data and triggers alerts
  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./monitoring/prometheus:/etc/prometheus
    # This command tells it to look for the config file we mapped above
    command: --config.file=/etc/prometheus/prometheus.yml
    restart: always

  # Alertmanager: Sends the notification to Slack
  alertmanager:
    image: prom/alertmanager:latest
    container_name: alertmanager
    ports:
      - "9093:9093"
    volumes:
      - ./monitoring/alertmanager:/etc/alertmanager
    command: --config.file=/etc/alertmanager/config.yml
    restart: always